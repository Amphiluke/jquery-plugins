/*!
 * spin-digits.js by Amphiluke, 2013 (c)
 * jQuery plugin to animate dynamic changes of numeric data on the web-page
 *
 * https://github.com/Amphiluke/jquery-plugins/tree/master/src/spin-digits
 */
(function(d){"use strict";var c={intFrac:/^(\D*)(\d[^\.]*)\.(\d+)(\D*)$/,nonNum:/[^\d\+\-\.]/g},a=(function(){var e=(document.body||document.documentElement).style;return("transition" in e||"WebkitTransition" in e||"MozTransition" in e||"MsTransition" in e||"OTransition" in e)})();function b(e){this.$el=e;this.currentValueStr=d.trim(e.text());this._setMarkup()}d.extend(b.prototype,{_setMarkup:function(){var h=this.$el.html(),i="<span class='spin-digit-prefix'>$1</span>",j="<span class='spin-digit-suffix'>$4</span>",f="<samp class='spin-digit-stat'></samp><span class='spin-digit-sheet'><samp class='spin-digit'></samp><samp class='spin-digit'>",k="</samp><samp class='spin-digit'></samp></span>",g=f+"$2"+k,e=f+"$3"+k;h=h.replace(c.intFrac,i+g+"."+e+j);h="<span class='spin-digit-wrap'>"+h+"</span>";this.$el.html(h);this.prefix=this.$el.find(".spin-digit-prefix");this.suffix=this.$el.find(".spin-digit-suffix")},_splitParts:function(g,l,j,f){var k={intg:{stat:j,dyn:""},frac:{stat:f,dyn:""}},e,h;if(g.length!==j.length){k.intg.dyn=j;k.frac.dyn=f;k.intg.stat=k.frac.stat="";return k}for(h=0,e=j.length;h<e;h++){if(g[h]!==j[h]){k.intg.stat=j.slice(0,h);k.intg.dyn=j.slice(h);k.frac.stat="";k.frac.dyn=f;return k}}for(h=0,e=f.length;h<e;h++){if(l[h]!==f[h]){k.frac.stat=f.slice(0,h);k.frac.dyn=f.slice(h);return k}}return k},setValue:function(l){var e,j,k,h,i,n,g,m,f,o;if(this.currentValueStr===l){return}e=parseFloat(l.replace(c.nonNum,""));j=l.match(c.intFrac);k=parseFloat(this.currentValueStr.replace(c.nonNum,""));h=this.currentValueStr.match(c.intFrac);if(isNaN(e)||!j||isNaN(k)||!h){throw new Error("Unable to parse the value")}i=(e>=k);n=this.$el.find(".spin-digit-stat");g=this.$el.find(".spin-digit-sheet");m=this.$el.find(".spin-digit");f=i?"spin-digit-sheet-spin-inc":"spin-digit-sheet-spin-dec";o=this._splitParts(h[2],h[3],j[2],j[3]);if(o.intg.dyn){n.eq(0).text(o.intg.stat);m.eq(1).text(h[2].slice(o.intg.stat.length));m.eq(i?0:2).text(o.intg.dyn);g.eq(0).addClass(f)}if(o.frac.dyn){n.eq(1).text(o.frac.stat);m.eq(4).text(h[3].slice(o.frac.stat.length));m.eq(i?3:5).text(o.frac.dyn);g.eq(1).addClass(f)}this.$el.attr("data-dynamics",i?"pos":"neg");this.prefix.html(j[1]);this.suffix.html(j[4]);this.currentValueStr=l},forceUpdate:function(h){var i=h.match(c.intFrac),j,g,e,f;if(!i){throw new Error("Unable to parse the value")}j=this.$el.find(".spin-digit-sheet");g=this.$el.find(".spin-digit");e=j.eq(0);f=e.hasClass("spin-digit-sheet-spin-inc")?0:(e.hasClass("spin-digit-sheet-spin-dec")?2:1);g.eq(f).text(i[2]);e=j.eq(1);f=e.hasClass("spin-digit-sheet-spin-inc")?3:(e.hasClass("spin-digit-sheet-spin-dec")?5:4);g.eq(f).text(i[3]);this.$el.find(".spin-digit-stat").text("");this.prefix.html(i[1]);this.suffix.html(i[4]);this.currentValueStr=h},reset:function(){var e=this.$el.find(".spin-digit-wrap");e.replaceWith(document.createTextNode(e.text()));this.$el.data("spinDigits",new b(this.$el))}});b._rebuild=function(e){var g=e.clone(),f=g.find(".spin-digit");if(e.hasClass("spin-digit-sheet-spin-inc")){f.eq(-1).prependTo(g)}else{f.eq(0).appendTo(g)}f=g.find(".spin-digit");f.not(f.eq(1)).text("");g.removeClass("spin-digit-sheet-spin-inc spin-digit-sheet-spin-dec");e.replaceWith(g)};if(!a){b.prototype.origSetValue=b.prototype.setValue;b.prototype.setValue=function(){var g=this,h=g.$el.find(".spin-digit-sheet").css("top")||"-16px",f=h.replace("-",""),e=function(){b._rebuild(d(this));g.$el.find(".spin-digit-sheet").css("top",h)};g.origSetValue.apply(this,arguments);g.$el.find(".spin-digit-sheet-spin-inc").stop().animate({top:"+="+f},1000,"linear",e);g.$el.find(".spin-digit-sheet-spin-dec").stop().animate({top:"-="+f},1000,"linear",e)}}d.fn.spinDigits=function(g,f){var e=typeof f;this.each(function(){var i=d(this),j=i.data("spinDigits"),h;if(!j){j=new b(i);i.data("spinDigits",j)}if(e!=="undefined"){h=(e==="function")?f.call(this,j):f;if(g==="set"){j.setValue(h)}else{if(g==="update"){j.forceUpdate(h)}}}});return this};d.expr[":"].spinned=function(e){return/(?:^|\s)spin\-digit\-sheet\-spin\-(?:inc|dec)(?:\s|$)/.test(e.className)};d(document).on("transitionend webkitTransitionEnd",".spin-digit-sheet",function(){b._rebuild(d(this))})})(window.jQuery);